<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Translator Studio</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="background-gradient"></div>

    <header class="studio-header">
        <div class="logo">
            <span class="logo-icon">üé¨</span>
            <h1>Video Translator Studio</h1>
        </div>
    </header>

    <main class="studio-layout">
        <!-- Main area: video + control panel side by side -->
        <div class="studio-main">
            <!-- Left: Video Player -->
            <div class="video-panel">
                <video id="studio-video" controls>
                    Your browser does not support the video tag.
                </video>
                <div class="current-subtitle" id="current-subtitle"></div>
                <div class="video-placeholder" id="video-placeholder">
                    <span class="placeholder-icon">üé¨</span>
                    <p>Upload or paste a URL to get started</p>
                </div>
            </div>

            <!-- Right: Control Panel (state-driven) -->
            <div class="control-panel" id="control-panel">

                <!-- SOURCE STATE -->
                <div class="panel-state panel-source" id="panel-source">
                    <h2 class="panel-title">Add Your Video</h2>

                    <div class="upload-zone" id="drop-zone">
                        <div class="upload-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                                <polyline points="17 8 12 3 7 8" />
                                <line x1="12" y1="3" x2="12" y2="15" />
                            </svg>
                        </div>
                        <p>Drop video or click to browse</p>
                        <span class="file-types">MP4, MOV, AVI, MKV</span>
                        <input type="file" id="file-input" accept=".mp4,.mov,.avi,.mkv" hidden>
                    </div>

                    <div class="file-preview" id="file-preview" style="display: none;">
                        <div class="file-info">
                            <span class="file-icon">üé•</span>
                            <div class="file-details">
                                <span class="file-name" id="file-name"></span>
                                <span class="file-size" id="file-size"></span>
                            </div>
                            <button class="remove-file" id="remove-file">‚úï</button>
                        </div>
                    </div>

                    <div class="divider-or"><span>OR</span></div>

                    <div class="url-input-section">
                        <div class="url-input-wrapper">
                            <input type="text" id="video-url" class="text-input"
                                placeholder="Paste YouTube or X/Twitter URL">
                            <span class="url-source-icon" id="url-source-icon"></span>
                        </div>
                        <div class="url-preview" id="url-preview" style="display: none;">
                            <img id="url-thumbnail" src="" alt="Thumbnail">
                            <div class="url-info">
                                <span class="url-title" id="url-title"></span>
                                <span class="url-duration" id="url-duration"></span>
                            </div>
                            <button class="remove-file" id="remove-url">‚úï</button>
                        </div>
                        <div class="url-loading" id="url-loading" style="display: none;">
                            <span class="spinner"></span>
                            <span>Fetching video info...</span>
                        </div>
                        <div class="url-error" id="url-error" style="display: none;"></div>
                    </div>

                    <div class="panel-divider"></div>

                    <!-- Language & Service Settings -->
                    <div class="options-section">
                        <div class="option-group">
                            <label class="option-label">
                                <span class="label-icon">üåê</span> Subtitle Language
                            </label>
                            <div class="toggle-buttons" id="language-toggle">
                                <button class="toggle-btn active" data-value="English">
                                    <span class="flag">üá∫üá∏</span> English
                                </button>
                                <button class="toggle-btn" data-value="Hebrew">
                                    <span class="flag">üáÆüá±</span> ◊¢◊ë◊®◊ô◊™
                                </button>
                            </div>
                        </div>

                        <div class="option-group">
                            <label class="option-label">
                                <span class="label-icon">ü§ñ</span> Translation Service
                            </label>
                            <div class="toggle-buttons" id="service-toggle">
                                <button class="toggle-btn active" data-value="openai">
                                    <span class="service-icon">‚ö°</span> OpenAI
                                </button>
                                <button class="toggle-btn" data-value="ollama">
                                    <span class="service-icon">ü¶ô</span> Ollama
                                </button>
                            </div>
                        </div>

                        <div class="option-group ollama-options" id="ollama-options" style="display: none;">
                            <label class="option-label">
                                <span class="label-icon">üì¶</span> Ollama Model
                            </label>
                            <select id="ollama-model" class="select-input">
                                <option value="llama3.2">llama3.2</option>
                                <option value="llama3.1">llama3.1</option>
                                <option value="mistral">mistral</option>
                                <option value="gemma2">gemma2</option>
                            </select>
                        </div>
                    </div>

                    <button class="btn btn-primary btn-translate" id="btn-translate" disabled>
                        <span class="btn-icon">‚ú®</span> Translate
                    </button>
                </div>

                <!-- DOWNLOADING STATE -->
                <div class="panel-state panel-downloading" id="panel-downloading" style="display: none;">
                    <h2 class="panel-title">Downloading Video</h2>
                    <div class="progress-bar-container">
                        <div class="progress-bar" id="download-progress-bar"></div>
                    </div>
                    <p class="status-message" id="download-status-text">Starting download...</p>
                </div>

                <!-- PROCESSING STATE -->
                <div class="panel-state panel-processing" id="panel-processing" style="display: none;">
                    <h2 class="panel-title">Processing Video</h2>
                    <p class="status-message" id="status-text">Preparing...</p>
                    <div class="progress-bar-container">
                        <div class="progress-bar" id="progress-bar"></div>
                    </div>
                    <div class="progress-steps">
                        <div class="step" id="step-extract">
                            <span class="step-icon">üéµ</span>
                            <span class="step-label">Extract</span>
                        </div>
                        <div class="step" id="step-transcribe">
                            <span class="step-icon">üé§</span>
                            <span class="step-label">Transcribe</span>
                        </div>
                        <div class="step" id="step-translate-progress">
                            <span class="step-icon">üåê</span>
                            <span class="step-label">Translate</span>
                        </div>
                        <div class="step" id="step-embed">
                            <span class="step-icon">üé¨</span>
                            <span class="step-label">Embed</span>
                        </div>
                    </div>
                    <div class="panel-error" id="processing-error" style="display: none;">
                        <p id="processing-error-text"></p>
                        <button class="btn btn-secondary" id="processing-retry-btn">Try Again</button>
                    </div>
                </div>

                <!-- EDITOR STATE -->
                <div class="panel-state panel-editor" id="panel-editor" style="display: none;">
                    <div class="subtitle-list-header">
                        <span class="subtitle-list-title">Subtitles</span>
                        <span class="subtitle-count" id="subtitle-count"></span>
                    </div>
                    <div class="subtitle-list" id="subtitle-list">
                        <!-- Rendered by JS -->
                    </div>
                    <div class="editor-actions">
                        <button class="btn btn-ghost" id="btn-skip-edit">Skip Editing</button>
                        <button class="btn btn-primary" id="btn-save-export">
                            <span class="btn-icon">üíæ</span> Save & Export
                        </button>
                    </div>
                </div>

            </div>
        </div>

        <!-- Trim Section (full width, below main) -->
        <div class="trim-section" id="trim-section" style="display: none;">
            <div class="trim-header">
                <span class="trim-label">‚úÇÔ∏è Trim Clip</span>
                <span id="trim-duration" class="trim-duration-label">Duration: --:--</span>
            </div>
            <div class="trim-slider-container">
                <div class="trim-thumbnails" id="trim-thumbnails"></div>
                <div class="trim-slider" id="trim-slider">
                    <div class="trim-range" id="trim-range"></div>
                    <div class="trim-handle trim-handle-start" id="trim-handle-start">
                        <div class="trim-handle-line"></div>
                    </div>
                    <div class="trim-handle trim-handle-end" id="trim-handle-end">
                        <div class="trim-handle-line"></div>
                    </div>
                    <div class="trim-playhead" id="trim-playhead"></div>
                </div>
                <div class="trim-times">
                    <div class="trim-time-input-group">
                        <label>Start</label>
                        <input type="text" id="trim-start-time" class="trim-time-input" value="00:00.0">
                    </div>
                    <div class="trim-time-input-group">
                        <label>End</label>
                        <input type="text" id="trim-end-time" class="trim-time-input" value="00:00.0">
                    </div>
                </div>
                <p class="trim-hint">Drag handles to trim ‚Ä¢ ‚Üê ‚Üí arrow keys for fine control (0.1s) ‚Ä¢ Click to seek</p>
            </div>
        </div>

        <!-- Export Section (full width, below trim) -->
        <div class="export-section" id="export-section" style="display: none;">
            <div class="export-header">
                <div class="success-icon">üéâ</div>
                <h2>Your Video is Ready!</h2>
            </div>

            <div class="stats-container">
                <div class="stat-item">
                    <span class="stat-icon">‚è±Ô∏è</span>
                    <span class="stat-label">Time</span>
                    <span class="stat-value" id="elapsed-time">--</span>
                </div>
                <div class="stat-item">
                    <span class="stat-icon">üì•</span>
                    <span class="stat-label">Input Tokens</span>
                    <span class="stat-value" id="input-tokens">--</span>
                </div>
                <div class="stat-item">
                    <span class="stat-icon">üì§</span>
                    <span class="stat-label">Output Tokens</span>
                    <span class="stat-value" id="output-tokens">--</span>
                </div>
                <div class="stat-item">
                    <span class="stat-icon">üí∞</span>
                    <span class="stat-label">Cost</span>
                    <span class="stat-value" id="total-cost">--</span>
                </div>
            </div>

            <div class="reburn-progress" id="reburn-progress" style="display: none;">
                <div class="progress-bar-container">
                    <div class="progress-bar" id="reburn-progress-bar"></div>
                </div>
                <p id="reburn-status-text">Re-embedding subtitles...</p>
            </div>

            <div class="download-buttons">
                <button class="btn btn-primary" id="download-video-btn">
                    <span class="btn-icon">‚¨áÔ∏è</span> Download Video with Subtitles
                </button>
                <div class="download-row">
                    <button class="btn btn-secondary" id="download-srt-btn">üìÑ Translated SRT</button>
                    <button class="btn btn-secondary" id="download-srt-txt-btn">üìÑ Translated TXT</button>
                </div>
                <div class="download-row">
                    <button class="btn btn-secondary" id="download-transcription-btn">üìù Original SRT</button>
                    <button class="btn btn-secondary" id="download-transcription-txt-btn">üìù Original TXT</button>
                </div>
            </div>

            <button class="btn btn-ghost" id="new-video-btn">Process Another Video</button>
        </div>
    </main>

    <footer class="footer">
        <p>Powered by OpenAI Whisper & GPT ‚Ä¢ Made with ‚ù§Ô∏è</p>
    </footer>

    <script src="script.js"></script>
</body>

</html>